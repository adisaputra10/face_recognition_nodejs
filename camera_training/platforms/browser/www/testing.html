<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
    <title>Camera</title>
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  </head>
  <body>
    <div class="controls">
      <div class="block">
        <button id="startCameraAboveButton">Start Camera</button>
        <button id="stopCameraButton">Stop Camera</button>
      </div>
      <div class="block">
        <button id="takePictureButton">Take Picture</button>
        <button id="switchCameraButton">Switch Camera</button>
      </div>
      
    </div>
    <div class="pictures">
      <img id="originalPicture" width="200"/>
    </div>
    <input required pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$" type="text" id="inputUsername" class="form-control thisfontblack" placeholder="Username"><br>
    <button id="simpanfoto">Training </button><br>
    <button id="backtomainmenu">Back To Main Menu</button>
    <section id="hasil_training" >

   

    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="CameraPreview.js"></script>
    <script type="text/javascript" src="js/camera.js"></script>
    <script>
      

      $('document').ready(function(){
  
       
    
        $('#tomainmenu').hide();
        $('#adduser').hide();
          $('#simpanfoto').on('click', function(){
             var username_s =$('#inputUsername').val();
              var id = Math.random().toString(36).substr(2, 9);
              get_image = $('#originalPicture').attr('src');

              if(username_s != ""){



                               $.ajax({
                                      url : 'http://eptw.webzz.id:2000/uploadimage',
                                      type : 'POST',
                                      data : { 
                                        base64image : get_image,
                                        username: $('#inputUsername').val()
                                      },
                                      success : function(resp){
                                        alert('success ');


                       
                                      //alert("muncul Form Input User");
                                      CameraPreview.stopCamera();
          
                                      },
                                      error: function (request, status, error) {
                                        
                                      CameraPreview.stopCamera();
                                    
                                      }
                                    });



                   


                                  $.ajax({url: 'http://eptw.webzz.id:2000/recognize/mobile/'+$('#inputUsername').val(), success: function(result){
                                      setTimeout(function(){   
                                          
                                          result.sort(compare);
                                          console.log(result);
                                          for(var i=0;i<result.length;i++){
                                          //   console.log(result[0].className);console.log(Math.round((1-result[i].distance)*100));
                                          }
                                          document.getElementById('hasil_training').innerHTML = " Hasil Prediksi :" + Math.round((1-result[0].distance)*100) + " %" ;
                                        // console.log(result[0].className);console.log(Math.round((1-result[0].distance)*100));
                                      },3000);
                                      hasil="success"
                                        },
                                    error: function(errorMsg){
                                        
                                        alert("Failed To Train, Check Your Connection")
                                  
                                    }
                                  });

                                  function compare(a,b) {
                                      if (a.distance < b.distance)
                                      return -1;
                                      if (a.distance > b.distance)
                                      return 1;
                                      return 0;
                                  }
             
                      


                

            }else{
                alert("Username empty");
              }





          });

          $('#backtomainmenu').on('click', function(){

            //navigator.geolocation.getCurrentPosition(onSuccesss, onErrors);
            CameraPreview.stopCamera();
            window.location.href = "index.html";
          });

          $('#tomainmenu').on('click', function(){

            navigator.geolocation.getCurrentPosition(onSuccesss, onErrors);
            var permit_no = localStorage.getItem("permit_no");
            var issuer = localStorage.getItem("issuer");
            var requester = localStorage.getItem("requester");
            var gps_lat = localStorage.getItem("lat");
            var start_complete = localStorage.getItem("start_complete");
            var gsp_lon = localStorage.getItem("lon");
            var face = localStorage.getItem("face");
            
         
 





            });




      });
    </script>




<script>

    
    
    function onSuccesss(position) {
            var element = document.getElementById('geolocation');
            
            localStorage.setItem('lat', "lat123");
            localStorage.setItem('lon', position.coords.longitude );

           alert("latt")          

        }
    
        // onError Callback receives a [PositionError](PositionError/positionError.html) object
        //
        function onErrors(error) {
            alert('code: '    + error.code    + '\n' +
                  'message: ' + error.message + '\n');
        }
    
    
    
    
    </script>




  </body>
</html>
